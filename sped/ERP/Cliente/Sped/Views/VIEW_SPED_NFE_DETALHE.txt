CREATE
VIEW t2tierp.VIEW_SPED_NFE_DETALHE
AS

select 
	NFED.*,
	NFEC.ID_TRIBUT_OPERACAO_FISCAL,
	P.ID_UNIDADE_PRODUTO,
	COFINS.CST_COFINS,
	COFINS.QUANTIDADE_VENDIDA AS QUANTIDADE_VENDIDA_COFINS,
	COFINS.BASE_CALCULO_COFINS,
	COFINS.ALIQUOTA_COFINS_PERCENTUAL,
	COFINS.ALIQUOTA_COFINS_REAIS,
	COFINS.VALOR_COFINS,
	ICMS.ORIGEM_MERCADORIA,
	ICMS.CST_ICMS,
	ICMS.CSOSN,
	ICMS.MODALIDADE_BC_ICMS,
	ICMS.TAXA_REDUCAO_BC_ICMS,
	ICMS.BASE_CALCULO_ICMS,
	ICMS.ALIQUOTA_ICMS,
	ICMS.VALOR_ICMS,
	ICMS.MOTIVO_DESONERACAO_ICMS,
	ICMS.MODALIDADE_BC_ICMS_ST,
	ICMS.PERCENTUAL_MVA_ICMS_ST,
	ICMS.PERCENTUAL_REDUCAO_BC_ICMS_ST,
	ICMS.VALOR_BASE_CALCULO_ICMS_ST,
	ICMS.ALIQUOTA_ICMS_ST,
	ICMS.VALOR_ICMS_ST,
	ICMS.VALOR_BC_ICMS_ST_RETIDO,
	ICMS.VALOR_ICMS_ST_RETIDO,
	ICMS.VALOR_BC_ICMS_ST_DESTINO,
	ICMS.VALOR_ICMS_ST_DESTINO,
	ICMS.ALIQUOTA_CREDITO_ICMS_SN,
	ICMS.VALOR_CREDITO_ICMS_SN,
	ICMS.PERCENTUAL_BC_OPERACAO_PROPRIA,
	ICMS.UF_ST,
	II.VALOR_BC_II,
	II.VALOR_DESPESAS_ADUANEIRAS,
	II.VALOR_IMPOSTO_IMPORTACAO,
	II.VALOR_IOF,
	IPI.ENQUADRAMENTO_IPI,
	IPI.CNPJ_PRODUTOR,
	IPI.CODIGO_SELO_IPI,
	IPI.QUANTIDADE_SELO_IPI,
	IPI.ENQUADRAMENTO_LEGAL_IPI,
	IPI.CST_IPI,
	IPI.VALOR_BASE_CALCULO_IPI,
	IPI.ALIQUOTA_IPI,
	IPI.QUANTIDADE_UNIDADE_TRIBUTAVEL,
	IPI.VALOR_UNIDADE_TRIBUTAVEL,
	IPI.VALOR_IPI,
	ISSQN.BASE_CALCULO_ISSQN,
	ISSQN.ALIQUOTA_ISSQN,
	ISSQN.VALOR_ISSQN,
	ISSQN.MUNICIPIO_ISSQN,
	ISSQN.ITEM_LISTA_SERVICOS,
	ISSQN.TRIBUTACAO_ISSQN,
	PIS.CST_PIS,
	PIS.QUANTIDADE_VENDIDA AS QUANTIDADE_VENDIDA_PIS,
	PIS.VALOR_BASE_CALCULO_PIS,
	PIS.ALIQUOTA_PIS_PERCENTUAL,
	PIS.ALIQUOTA_PIS_REAIS,
	PIS.VALOR_PIS 	
from
	NFE_DETALHE NFED 
	LEFT JOIN NFE_DETALHE_IMPOSTO_COFINS COFINS ON (COFINS.ID_NFE_DETALHE = NFED.ID)
	LEFT JOIN NFE_DETALHE_IMPOSTO_ICMS ICMS ON (ICMS.ID_NFE_DETALHE = NFED.ID)
	LEFT JOIN NFE_DETALHE_IMPOSTO_II II ON (II.ID_NFE_DETALHE = NFED.ID)
	LEFT JOIN NFE_DETALHE_IMPOSTO_IPI IPI ON (IPI.ID_NFE_DETALHE = NFED.ID)
	LEFT JOIN NFE_DETALHE_IMPOSTO_ISSQN ISSQN ON (ISSQN.ID_NFE_DETALHE = NFED.ID)
	LEFT JOIN NFE_DETALHE_IMPOSTO_PIS PIS ON (PIS.ID_NFE_DETALHE = NFED.ID)
	LEFT JOIN PRODUTO P ON (NFED.ID_PRODUTO = P.ID)
	LEFT JOIN NFE_CABECALHO NFEC ON (NFED.ID_NFE_CABECALHO = NFEC.ID)